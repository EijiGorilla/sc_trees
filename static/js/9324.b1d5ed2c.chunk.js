"use strict";(self.webpackChunksc_trees=self.webpackChunksc_trees||[]).push([[9324],{80457:(e,t,i)=>{i.d(t,{Z:()=>s});class s{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.lengths=e??[],this.coords=t??[]}static fromJSON(e){return new s(e.lengths,e.coords)}static fromRect(e){const[t,i,n,r]=e,h=n-t,l=r-i;return new s([5],[t,i,h,0,0,l,-h,0,0,-l])}get isPoint(){return 0===this.lengths.length&&this.coords.length>=2}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce(((e,t)=>e+t))}forEachVertex(e){let t=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let i=0;i<this.lengths.length;i++){const s=this.lengths[i];for(let i=0;i<s;i++)e(this.coords[2*(i+t)],this.coords[2*(i+t)+1]);t+=s}}deltaDecode(){const e=this.clone(),{coords:t,lengths:i}=e;let s=0;for(const n of i){for(let e=1;e<n;e++)t[2*(s+e)]+=t[2*(s+e)-2],t[2*(s+e)+1]+=t[2*(s+e)-1];s+=n}return e}clone(e){if(0===this.lengths.length)return new s([],[this.coords[0],this.coords[1]]);const t=2*(0===this.lengths.length?1:this.lengths.reduce(((e,t)=>e+t))),i=this.coords.slice(0,t);return e?(e.set(i),new s(this.lengths,e)):new s(Array.from(this.lengths),Array.from(i))}}},59001:(e,t,i)=>{i.d(t,{Z:()=>r});var s=i(82272),n=i(51e3);class r{constructor(){this._resourceMap=new Map,this._inFlightResourceMap=new Map,this.geometryEngine=null,this.geometryEnginePromise=null}destroy(){this._inFlightResourceMap.clear(),this._resourceMap.clear()}getResource(e){return this._resourceMap.get(e)??null}async fetchResource(e,t){const i=this._resourceMap.get(e);if(i)return{width:i.width,height:i.height};let s=this._inFlightResourceMap.get(e);return s?s.then((e=>({width:e.width,height:e.height}))):(s=(0,n.n$)(e,t),this._inFlightResourceMap.set(e,s),s.then((t=>(this._inFlightResourceMap.delete(e),this._resourceMap.set(e,t),{width:t.width,height:t.height})),(()=>({width:0,height:0}))))}deleteResource(e){this._inFlightResourceMap.delete(e),this._resourceMap.delete(e)}loadFont(e){return(0,s.mx)(e)}}},60975:(e,t,i)=>{i.d(t,{previewCIMSymbol:()=>p});var s=i(17842),n=i(78915),r=i(59001),h=i(28222),l=i(41015),a=i(31027);function o(e,t,i,s){const n=-t/2+1,r=t/2-1,h=i/2-1,l=-i/2+1;switch(e){case"esriGeometryPoint":return{x:0,y:0};case"esriGeometryPolyline":return{paths:[[[n,0],[0,0],[r,0]]]};default:return"legend"===s?{rings:[[[n,h],[r,0],[r,l],[n,l],[n,h]]]}:{rings:[[[n,h],[r,h],[r,l],[n,l],[n,h]]]}}}var c=i(37817),g=i(69157);const u=new class{constructor(e){this._spatialReference=e,this._imageDataCanvas=null,this._cimResourceManager=new r.Z}get _canvas(){return this._imageDataCanvas||(this._imageDataCanvas=document.createElement("canvas")),this._imageDataCanvas}get resourceManager(){return this._cimResourceManager}async rasterizeCIMSymbolAsync(e,t,i,s,r,h,c,g,u){if(!e)return null;const{data:d}=e;if(!d||"CIMSymbolReference"!==d.type||!d.symbol)return null;const{symbol:y}=d;h||(h=(0,a.JW)(y));const m=await l.E.resolveSymbolOverrides(d,t,this._spatialReference,r,h,c,g),w=this._cimResourceManager,f=[];n.B$.fetchResources(m,w,f),n.B$.fetchFonts(m,w,f),f.length>0&&await Promise.all(f);const{width:p,height:M}=i,b=o(h,p,M,s),v=n.B$.getEnvelope(m,b,w);if(!v)return null;v.x===1/0&&(v.x=p+2),v.y===1/0&&(v.y=-M/2),v.width===-1/0&&(v.width=p),v.height===-1/0&&(v.height=M);let _=1,R=0,C=0;switch(y.type){case"CIMPointSymbol":case"CIMTextSymbol":{let e=1;v.width>p&&(e=p/v.width);let t=1;v.height>M&&(t=M/v.height),"preview"===s&&(v.width<p&&(e=p/v.width),v.height<M&&(t=M/v.height)),_=Math.min(e,t),R=v.x+v.width/2,C=v.y+v.height/2}break;case"CIMLineSymbol":{(u||v.height>M)&&(_=M/v.height),C=v.y+v.height/2;const e=v.x*_+p/2,t=(v.x+v.width)*_+p/2,{paths:i}=b;i[0][0][0]-=e/_,i[0][2][0]-=(t-p)/_}break;case"CIMPolygonSymbol":{R=v.x+v.width/2,C=v.y+v.height/2;const e=v.x*_+p/2,t=(v.x+v.width)*_+p/2,i=v.y*_+M/2,s=(v.y+v.height)*_+M/2,{rings:n}=b;e<0&&(n[0][0][0]-=e,n[0][3][0]-=e,n[0][4][0]-=e),i<0&&(n[0][0][1]+=i,n[0][1][1]+=i,n[0][4][1]+=i),t>p&&(n[0][1][0]-=t-p,n[0][2][0]-=t-p),s>M&&(n[0][2][1]+=s-M,n[0][3][1]+=s-M)}}const x={type:"cim",data:{type:"CIMSymbolReference",symbol:m}};return this.rasterize(x,p,M,R,C,_,h,1,b)}rasterize(e,t,i,s,n,r,l){let c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,g=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;const{data:u}=e;if(!u||"CIMSymbolReference"!==u.type||!u.symbol)return null;const{symbol:d}=u,y=this._canvas,m=1.3333333333333333*(window.devicePixelRatio||1);y.width=t*m,y.height=i*m,l||(l=(0,a.JW)(d)),g||(g=o(l,t,i,"legend")),y.width+=2*c,y.height+=2*c;const w=y.getContext("2d",{willReadFrequently:!0}),f=h.zA.createIdentity();return f.translate(-s,-n),f.scale(r*m,-r*m),f.translate(t*m/2+c,i*m/2+c),w.clearRect(0,0,y.width,y.height),new h.cD(w,this._cimResourceManager,f,!0).drawSymbol(d,g),w.getImageData(0,0,y.width,y.height)}}(null),d=(0,s.Wz)(c.b_.size),y=(0,s.Wz)(c.b_.maxSize),m=(0,s.Wz)(c.b_.lineWidth),w=1;async function f(e,t,i){const s=t?.size;let r=null!=s&&"object"==typeof s&&"width"in s?s.width:s,h=null!=s&&"object"==typeof s&&"height"in s?s.height:s;if(null==r||null==h)if("esriGeometryPolygon"===i)r=d,h=d;else{const s=await async function(e,t,i){const{feature:s,fieldMap:r,viewParams:h}=t.cimOptions||t,a=await l.E.resolveSymbolOverrides(e.data,s,null,r,i,null,h);if(!a)return null;(e=e.clone()).data={type:"CIMSymbolReference",symbol:a},e.data.primitiveOverrides=void 0;const o=[];return n.B$.fetchResources(a,u.resourceManager,o),n.B$.fetchFonts(a,u.resourceManager,o),o.length>0&&await Promise.all(o),n.B$.getEnvelope(a,null,u.resourceManager)}(e,t,i);s&&(r=s.width,h=s.height),"esriGeometryPolyline"===i&&(r=m),r=null!=r&&isFinite(r)?Math.min(r,y):d,h=null!=h&&isFinite(h)?Math.max(Math.min(h,y),w):d}return"legend"===t.style&&"esriGeometryPolyline"===i&&(r=m),{width:r,height:h}}async function p(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{node:i,opacity:n,symbolConfig:r}=t,h=null!=r&&"object"==typeof r&&"isSquareFill"in r&&r.isSquareFill,l=t.cimOptions||t,o=l.geometryType||(0,a.JW)(e?.data?.symbol),c=await f(e,t,o),{feature:d,fieldMap:y}=l,m=h||"esriGeometryPolygon"!==o?"preview":"legend",w=await u.rasterizeCIMSymbolAsync(e,d,c,m,y,o,null,l.viewParams,l.allowScalingUp);if(!w)return null;const{width:p,height:M}=w,b=document.createElement("canvas");b.width=p,b.height=M,b.getContext("2d").putImageData(w,0,0);const v=(0,s.F2)(c.width),_=(0,s.F2)(c.height),R=new Image(v,_);R.src=b.toDataURL(),R.ariaLabel=t.ariaLabel??null,R.alt=t.ariaLabel??"",null!=n&&(R.style.opacity=`${n}`);let C=R;if(null!=t.effectView){const e={shape:{type:"image",x:0,y:0,width:v,height:_,src:R.src},fill:null,stroke:null,offset:[0,0]};C=(0,g.wh)([[e]],[v,_],{effectView:t.effectView,ariaLabel:t.ariaLabel})}return i&&C&&i.appendChild(C),C}}}]);
//# sourceMappingURL=9324.b1d5ed2c.chunk.js.map